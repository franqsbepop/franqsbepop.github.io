<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Diogo Franquinho - Book Reviews">
    <title>Book Reviews - Diogo Franquinho</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/book-reviews.css">
</head>
<body>
    <header>
        <nav class="top-nav">
            <h2>
                <a href="../index.html#biography">Biography</a> | 
                <a href="../index.html#research">Research</a> | 
                <a href="../index.html#publications">Publications</a> | 
                <a href="../index.html#teaching">Teaching</a> | 
                <a href="../blog.html">Blog</a> | 
                <a href="../index.html#contact">Contact</a>
            </h2>
        </nav>
    </header>

    <main>
        <h1>Book Reviews</h1>
        <section id="book-list" class="book-list">
            <!-- Books will be loaded here -->
        </section>
    </main>

    <footer>
        <p>&copy; Diogo Franquinho | Book Reviews</p>
    </footer>

    <script>
        async function loadBooks() {
            try {
                const response = await fetch('goodreads_library_export.csv');
                const csvText = await response.text();
                const books = parseCSV(csvText);
                displayBooks(books);
            } catch (error) {
                console.error('Error loading books:', error);
                document.getElementById('book-list').innerHTML = '<p>Error loading books. Please try again later.</p>';
            }
        }

        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',');
            const books = [];

            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const values = lines[i].split(',');
                const book = {};
                
                headers.forEach((header, index) => {
                    book[header.trim()] = values[index]?.replace(/^="(.*)"$/, '$1').trim() || '';
                });
                
                books.push(book);
            }

            return books;
        }

        function displayBooks(books) {
            const container = document.getElementById('book-list');
            const readBooks = books.filter(book => book['Exclusive Shelf'] === 'read');
            
            readBooks.sort((a, b) => new Date(b['Date Read']) - new Date(a['Date Read']));
            
            container.innerHTML = readBooks.map(book => `
                <article class="book-review">
                    <h2>${book.Title}</h2>
                    <p>Author: ${book.Author}</p>
                    <p class="book-meta">
                        Published: ${book['Original Publication Year'] || book['Year Published'] || 'N/A'}
                    </p>
                    <p class="book-rating">Rating: ${book['My Rating'] || 'Unrated'}/5</p>
                    ${book['My Review'] ? `
                        <p class="book-review-text">Review: ${book['My Review']}</p>
                    ` : ''}
                </article>
            `).join('');
        }

        // Load books when the page loads
        document.addEventListener('DOMContentLoaded', loadBooks);
    </script>
</body>
</html>